extends layout

block content
  if hasTimeSeries
    script(src='https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js')
    script(src='https://cdn.jsdelivr.net/gh/joeuhren/chartjs-plugin-crosshair@v2.0.5/build/chartjs-plugin-crosshair.min.js')
    script(src='https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1')
  script.
    $(document).ready(function() {
      // Handle last updated date display
      if ('#{dashboardSettings.page_header.show_last_updated}' == 'true') {
        var lastUpdatedDate = #{(last_updated == null || last_updated == '0' ? 0 : last_updated)};
        if (lastUpdatedDate != 0) {
          $('span#lastUpdatedDate').html(' ' + format_unixtime(lastUpdatedDate));
        } else
          $('span#lastUpdatedDate').html(' N/A');
      }
    });
  
  .container-fluid
    .row.mt-4
      .col-12
        .d-flex.justify-content-between.align-items-center.mb-4
          h1.mb-0 #{settings.coin.name} Blockchain Dashboard
          if hasTimeSeries && dashboardSettings.time_filters && dashboardSettings.time_filters.length > 0
            .btn-group(role='group' aria-label='Time range selector')
              each filterDays in dashboardSettings.time_filters
                if filterDays === -1
                  a.btn.btn-sm.btn-outline-primary(href='/dashboard?days=all' class=(timeRange == 'all' ? 'active' : '')) All Time
                else
                  a.btn.btn-sm.btn-outline-primary(href=`/dashboard?days=${filterDays}` class=(timeRange == filterDays ? 'active' : ''))= filterDays + ' Days'
        if dashboardSettings.page_header.show_last_updated == true
          .sub-page-header
            span.fw-bold=settings.localization.last_updated + ':'
            span.text-muted#lastUpdatedDate
    
    if dashboardSettings.top_panels.show_latest_block || dashboardSettings.top_panels.show_difficulty || dashboardSettings.top_panels.show_total_supply || dashboardSettings.top_panels.show_total_transactions
      .row.g-4
        // Latest Block Info
        if dashboardSettings.top_panels.show_latest_block
          .col-xl-3.col-lg-4.col-md-6
            .card.h-100
              .card-body
                h5.card-title
                  i.fas.fa-cube.me-2
                  | Latest Block
                hr
                .mb-2
                  strong Height:
                  span.ms-2= data.latestBlockHeight.toLocaleString()
                .mb-2
                  strong Hash:
                  .text-break.small.mt-1
                    a(href='/block/' + data.latestBlockHash)= data.latestBlockHash

        // Difficulty
        if dashboardSettings.top_panels.show_difficulty
          .col-xl-3.col-lg-4.col-md-6
            .card.h-100
              .card-body
                h5.card-title
                  i.fas.fa-chart-line.me-2
                  | Difficulty
                hr
                - var difficultyValue = data.difficulty.toFixed(8);
                - var difficultyParts = difficultyValue.split(".");
                - var difficultyDecimal = difficultyParts[1].replace(/(\d{3})/g, '$1 ').trim();
                p.h4.mb-0 #{difficultyParts[0]}.
                  span.decimal #{difficultyDecimal}

        // Total Supply
        if dashboardSettings.top_panels.show_total_supply
          .col-xl-3.col-lg-4.col-md-6
            .card.h-100
              .card-body
                h5.card-title
                  i.fas.fa-coins.me-2
                  | Total Supply
                hr
                p.h4.mb-0= data.totalSupply.toLocaleString() + ' ' + settings.coin.symbol

        // Total Transactions
        if dashboardSettings.top_panels.show_total_transactions
          .col-xl-3.col-lg-4.col-md-6
            .card.h-100
              .card-body
                h5.card-title
                  i.fas.fa-exchange-alt.me-2
                  | Total Transactions
                hr
                p.h4.mb-0= data.totalTxCount.toLocaleString()

    if hasTimeSeries && dashboardSettings.rolling_averages.enabled
      .row.g-4.mt-3
        .col-12
          .card
            .card-body
              h5.card-title
                i.fas.fa-chart-area.me-2
                | Rolling Averages
              hr
              .row
                .col-md-4
                  h6 Last 60 Blocks (~1 Hour)
                  ul.list-unstyled
                    if dashboardSettings.rolling_averages.metrics.show_block_interval
                      - var blockInterval60 = rolling.last60.blockInterval.toFixed(2);
                      - var blockInterval60Parts = blockInterval60.split(".");
                      - var blockInterval60Decimal = blockInterval60Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Block Interval: 
                        = blockInterval60Parts[0] + '.'
                        span.decimal #{blockInterval60Decimal}
                        = ' s'
                    if dashboardSettings.rolling_averages.metrics.show_avg_tx_count
                      - var txCount60 = rolling.last60.txCount.toFixed(2);
                      - var txCount60Parts = txCount60.split(".");
                      - var txCount60Decimal = txCount60Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Avg Tx Count: 
                        = txCount60Parts[0] + '.'
                        span.decimal #{txCount60Decimal}
                    if dashboardSettings.rolling_averages.metrics.show_avg_tx_value
                      - var txValue60 = ((rolling.last60.txCountSum > 0 ? rolling.last60.txValueSum / rolling.last60.txCountSum : 0) / 100000000).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                      - var txValue60Parts = txValue60.split(".");
                      - var txValue60Decimal = txValue60Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Avg Tx Value: 
                        = txValue60Parts[0] + '.'
                        span.decimal #{txValue60Decimal}
                        = ' ' + settings.coin.symbol
                    if dashboardSettings.rolling_averages.metrics.show_avg_tx_fees
                      - var fees60 = ((rolling.last60.fees / 100000000).toLocaleString(undefined, {minimumFractionDigits: 8, maximumFractionDigits: 8}));
                      - var fees60Parts = fees60.split(".");
                      - var fees60Decimal = fees60Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Avg Tx Fees: 
                        = fees60Parts[0] + '.'
                        span.decimal #{fees60Decimal}
                        = ' ' + settings.coin.symbol
                    if dashboardSettings.rolling_averages.metrics.show_sum_tx_count
                      li
                        strong Sum Tx Count: 
                        = rolling.last60.txCountSum.toLocaleString()
                    if dashboardSettings.rolling_averages.metrics.show_sum_tx_value
                      - var sumTxValue60 = ((rolling.last60.txValueSum / 100000000).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}));
                      - var sumTxValue60Parts = sumTxValue60.split(".");
                      - var sumTxValue60Decimal = sumTxValue60Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Sum Tx Value: 
                        = sumTxValue60Parts[0] + '.'
                        span.decimal #{sumTxValue60Decimal}
                        = ' ' + settings.coin.symbol
                    if dashboardSettings.rolling_averages.metrics.show_sum_tx_fees
                      - var sumFees60 = ((rolling.last60.feesSum / 100000000).toLocaleString(undefined, {minimumFractionDigits: 8, maximumFractionDigits: 8}));
                      - var sumFees60Parts = sumFees60.split(".");
                      - var sumFees60Decimal = sumFees60Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Sum Tx Fees: 
                        = sumFees60Parts[0] + '.'
                        span.decimal #{sumFees60Decimal}
                        = ' ' + settings.coin.symbol
                .col-md-4
                  h6 Last 1,440 Blocks (~1 Day)
                  ul.list-unstyled
                    if dashboardSettings.rolling_averages.metrics.show_block_interval
                      - var blockInterval1440 = rolling.last1440.blockInterval.toFixed(2);
                      - var blockInterval1440Parts = blockInterval1440.split(".");
                      - var blockInterval1440Decimal = blockInterval1440Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Block Interval: 
                        = blockInterval1440Parts[0] + '.'
                        span.decimal #{blockInterval1440Decimal}
                        = ' s'
                    if dashboardSettings.rolling_averages.metrics.show_avg_tx_count
                      - var txCount1440 = rolling.last1440.txCount.toFixed(2);
                      - var txCount1440Parts = txCount1440.split(".");
                      - var txCount1440Decimal = txCount1440Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Avg Tx Count: 
                        = txCount1440Parts[0] + '.'
                        span.decimal #{txCount1440Decimal}
                    if dashboardSettings.rolling_averages.metrics.show_avg_tx_value
                      - var txValue1440 = ((rolling.last1440.txCountSum > 0 ? rolling.last1440.txValueSum / rolling.last1440.txCountSum : 0) / 100000000).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                      - var txValue1440Parts = txValue1440.split(".");
                      - var txValue1440Decimal = txValue1440Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Avg Tx Value: 
                        = txValue1440Parts[0] + '.'
                        span.decimal #{txValue1440Decimal}
                        = ' ' + settings.coin.symbol
                    if dashboardSettings.rolling_averages.metrics.show_avg_tx_fees
                      - var fees1440 = ((rolling.last1440.fees / 100000000).toLocaleString(undefined, {minimumFractionDigits: 8, maximumFractionDigits: 8}));
                      - var fees1440Parts = fees1440.split(".");
                      - var fees1440Decimal = fees1440Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Avg Tx Fees: 
                        = fees1440Parts[0] + '.'
                        span.decimal #{fees1440Decimal}
                        = ' ' + settings.coin.symbol
                    if dashboardSettings.rolling_averages.metrics.show_sum_tx_count
                      li
                        strong Sum Tx Count: 
                        = rolling.last1440.txCountSum.toLocaleString()
                    if dashboardSettings.rolling_averages.metrics.show_sum_tx_value
                      - var sumTxValue1440 = ((rolling.last1440.txValueSum / 100000000).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}));
                      - var sumTxValue1440Parts = sumTxValue1440.split(".");
                      - var sumTxValue1440Decimal = sumTxValue1440Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Sum Tx Value: 
                        = sumTxValue1440Parts[0] + '.'
                        span.decimal #{sumTxValue1440Decimal}
                        = ' ' + settings.coin.symbol
                    if dashboardSettings.rolling_averages.metrics.show_sum_tx_fees
                      - var sumFees1440 = ((rolling.last1440.feesSum / 100000000).toLocaleString(undefined, {minimumFractionDigits: 8, maximumFractionDigits: 8}));
                      - var sumFees1440Parts = sumFees1440.split(".");
                      - var sumFees1440Decimal = sumFees1440Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Sum Tx Fees: 
                        = sumFees1440Parts[0] + '.'
                        span.decimal #{sumFees1440Decimal}
                        = ' ' + settings.coin.symbol
                .col-md-4
                  h6 Last 10,000 Blocks (~1 Week)
                  ul.list-unstyled
                    if dashboardSettings.rolling_averages.metrics.show_block_interval
                      - var blockInterval10000 = rolling.last10000.blockInterval.toFixed(2);
                      - var blockInterval10000Parts = blockInterval10000.split(".");
                      - var blockInterval10000Decimal = blockInterval10000Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Block Interval: 
                        = blockInterval10000Parts[0] + '.'
                        span.decimal #{blockInterval10000Decimal}
                        = ' s'
                    if dashboardSettings.rolling_averages.metrics.show_avg_tx_count
                      - var txCount10000 = rolling.last10000.txCount.toFixed(2);
                      - var txCount10000Parts = txCount10000.split(".");
                      - var txCount10000Decimal = txCount10000Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Avg Tx Count: 
                        = txCount10000Parts[0] + '.'
                        span.decimal #{txCount10000Decimal}
                    if dashboardSettings.rolling_averages.metrics.show_avg_tx_value
                      - var txValue10000 = ((rolling.last10000.txCountSum > 0 ? rolling.last10000.txValueSum / rolling.last10000.txCountSum : 0) / 100000000).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                      - var txValue10000Parts = txValue10000.split(".");
                      - var txValue10000Decimal = txValue10000Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Avg Tx Value: 
                        = txValue10000Parts[0] + '.'
                        span.decimal #{txValue10000Decimal}
                        = ' ' + settings.coin.symbol
                    if dashboardSettings.rolling_averages.metrics.show_avg_tx_fees
                      - var fees10000 = ((rolling.last10000.fees / 100000000).toLocaleString(undefined, {minimumFractionDigits: 8, maximumFractionDigits: 8}));
                      - var fees10000Parts = fees10000.split(".");
                      - var fees10000Decimal = fees10000Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Avg Tx Fees: 
                        = fees10000Parts[0] + '.'
                        span.decimal #{fees10000Decimal}
                        = ' ' + settings.coin.symbol
                    if dashboardSettings.rolling_averages.metrics.show_sum_tx_count
                      li
                        strong Sum Tx Count: 
                        = rolling.last10000.txCountSum.toLocaleString()
                    if dashboardSettings.rolling_averages.metrics.show_sum_tx_value
                      - var sumTxValue10000 = ((rolling.last10000.txValueSum / 100000000).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}));
                      - var sumTxValue10000Parts = sumTxValue10000.split(".");
                      - var sumTxValue10000Decimal = sumTxValue10000Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Sum Tx Value: 
                        = sumTxValue10000Parts[0] + '.'
                        span.decimal #{sumTxValue10000Decimal}
                        = ' ' + settings.coin.symbol
                    if dashboardSettings.rolling_averages.metrics.show_sum_tx_fees
                      - var sumFees10000 = ((rolling.last10000.feesSum / 100000000).toLocaleString(undefined, {minimumFractionDigits: 8, maximumFractionDigits: 8}));
                      - var sumFees10000Parts = sumFees10000.split(".");
                      - var sumFees10000Decimal = sumFees10000Parts[1].replace(/(\d{3})/g, '$1 ').trim();
                      li
                        strong Sum Tx Fees: 
                        = sumFees10000Parts[0] + '.'
                        span.decimal #{sumFees10000Decimal}
                        = ' ' + settings.coin.symbol

    if hasTimeSeries && daily && daily.length > 0
      - let chartCounter = 0
      if dashboardSettings.charts.show_tx_count || dashboardSettings.charts.show_tx_value
        .row.g-4.mt-3
          if dashboardSettings.charts.show_tx_count
            - chartCounter++
            .col-lg-6
              .card
                .card-body
                  h5.card-title= chartCounter + '. Daily Transaction Count (Net)'
                  canvas(id='txCountChart')
          if dashboardSettings.charts.show_tx_value
            - chartCounter++
            .col-lg-6
              .card
                .card-body
                  h5.card-title= chartCounter + '. Daily Transaction Value (Net)'
                  canvas(id='txValueChart')
      
      if dashboardSettings.charts.show_block_rewards || dashboardSettings.charts.show_fees
        .row.g-4.mt-3
          if dashboardSettings.charts.show_block_rewards
            - chartCounter++
            .col-lg-6
              .card
                .card-body
                  h5.card-title= chartCounter + '. Daily Block Rewards'
                  canvas(id='blockRewardChart')
          if dashboardSettings.charts.show_fees
            - chartCounter++
            .col-lg-6
              .card
                .card-body
                  h5.card-title= chartCounter + '. Daily Fees'
                  canvas(id='feesChart')
      
      if dashboardSettings.charts.show_blocks || dashboardSettings.charts.show_block_time
        .row.g-4.mt-3
          if dashboardSettings.charts.show_blocks
            - chartCounter++
            .col-lg-6
              .card
                .card-body
                  h5.card-title= chartCounter + '. Daily Blocks'
                  canvas(id='blocksChart')
          if dashboardSettings.charts.show_block_time
            - chartCounter++
            .col-lg-6
              .card
                .card-body
                  h5.card-title= chartCounter + '. Daily Average Block Time'
                  canvas(id='blockTimeChart')

      script.
        document.addEventListener('DOMContentLoaded', function() {
          const dailyData = !{JSON.stringify(daily)};
          const labels = dailyData.map(d => d.date);
          const timeRange = !{JSON.stringify(timeRange)};
          const dashboardSettings = !{JSON.stringify(dashboardSettings)};
          
          // Determine if points should be hidden based on time range and filter configuration
          let hidePoints = false;
          if (dashboardSettings.time_filters && dashboardSettings.time_filters.length > 0) {
            const maxFilter = Math.max(...dashboardSettings.time_filters.filter(f => f !== -1));
            hidePoints = (timeRange === 'all' || (typeof timeRange === 'number' && timeRange >= 90));
          }
          
          // Detect if the last day is the current running day (today)
          const today = new Date().toISOString().split('T')[0];
          const lastDataDate = dailyData.length > 0 ? dailyData[dailyData.length - 1].date : null;
          const isLastDayRunning = lastDataDate === today;
          
          // Helper function to create hatched pattern for bar charts
          function createHatchPattern(color) {
            // Create a canvas to draw the pattern
            const canvas = document.createElement('canvas');
            canvas.width = 10;
            canvas.height = 10;
            const ctx = canvas.getContext('2d');
            
            // Parse the RGB color and create a lighter version for hatching
            const rgbMatch = color.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
            if (rgbMatch) {
              const r = parseInt(rgbMatch[1]);
              const g = parseInt(rgbMatch[2]);
              const b = parseInt(rgbMatch[3]);
              
              // Fill with lighter color (70% opacity)
              ctx.fillStyle = `rgba(${r}, ${g}, ${b}, 0.3)`;
              ctx.fillRect(0, 0, 10, 10);
              
              // Draw diagonal lines
              ctx.strokeStyle = color;
              ctx.lineWidth = 2;
              ctx.beginPath();
              ctx.moveTo(0, 10);
              ctx.lineTo(10, 0);
              ctx.stroke();
              
              ctx.beginPath();
              ctx.moveTo(-5, 5);
              ctx.lineTo(5, -5);
              ctx.stroke();
              
              ctx.beginPath();
              ctx.moveTo(5, 15);
              ctx.lineTo(15, 5);
              ctx.stroke();
            }
            
            // Return the pattern
            return ctx.createPattern(canvas, 'repeat');
          }
          
          // Common options for all charts
          const commonOptions = {
            responsive: true,
            maintainAspectRatio: true,
            interaction: {
              mode: 'index',
              intersect: false
            },
            plugins: {
              tooltip: {
                mode: 'index',
                intersect: false
              },
              crosshair: {
                line: {
                  color: '#F66',
                  width: 1,
                  dashPattern: [5, 5]
                },
                sync: {
                  enabled: true,
                  group: 1,
                  suppressTooltips: false
                },
                zoom: {
                  enabled: false
                }
              }
            }
          };
          
          // 1. Transaction Count Chart
          if (dashboardSettings.charts.show_tx_count) {
            // Create background colors array - last bar hatched if it's the running day
            const txCountColors = dailyData.map((d, i) => {
              if (isLastDayRunning && i === dailyData.length - 1) {
                return createHatchPattern('rgb(75, 192, 192)');
              }
              return 'rgb(75, 192, 192)';
            });
            
            new Chart(document.getElementById('txCountChart'), {
              type: 'bar',
              data: {
                labels: labels,
                datasets: [{
                  label: 'Transaction Count (Net)',
                  data: dailyData.map(d => d.tx_count_total),
                  backgroundColor: txCountColors
                }]
              },
              options: commonOptions
            });
          }
          
          // 2. Transaction Value Chart
          if (dashboardSettings.charts.show_tx_value) {
            // For line charts with running day, we need to split the data
            const txValueDatasets = [];
            
            if (isLastDayRunning && dailyData.length > 1) {
              // Complete days dataset (solid line)
              txValueDatasets.push({
                label: 'Transaction Value (' + !{JSON.stringify(settings.coin.symbol)} + ')',
                data: dailyData.slice(0, -1).map(d => d.tx_value_total),
                borderColor: 'rgb(153, 102, 255)',
                backgroundColor: 'rgba(153, 102, 255, 0.1)',
                fill: true,
                tension: 0.1,
                pointRadius: hidePoints ? 0 : 3,
                pointHoverRadius: hidePoints ? 0 : 5
              });
              
              // Running day segment (dotted line)
              txValueDatasets.push({
                label: 'Transaction Value - Running Day (' + !{JSON.stringify(settings.coin.symbol)} + ')',
                data: [
                  ...Array(dailyData.length - 2).fill(null),
                  dailyData[dailyData.length - 2].tx_value_total,
                  dailyData[dailyData.length - 1].tx_value_total
                ],
                borderColor: 'rgb(153, 102, 255)',
                backgroundColor: 'rgba(153, 102, 255, 0.1)',
                fill: true,
                tension: 0.1,
                borderDash: [5, 5],
                pointRadius: hidePoints ? 0 : 3,
                pointHoverRadius: hidePoints ? 0 : 5
              });
            } else {
              // No running day or only one data point - use solid line
              txValueDatasets.push({
                label: 'Transaction Value (' + !{JSON.stringify(settings.coin.symbol)} + ')',
                data: dailyData.map(d => d.tx_value_total),
                borderColor: 'rgb(153, 102, 255)',
                backgroundColor: 'rgba(153, 102, 255, 0.1)',
                fill: true,
                tension: 0.1,
                pointRadius: hidePoints ? 0 : 3,
                pointHoverRadius: hidePoints ? 0 : 5
              });
            }
            
            new Chart(document.getElementById('txValueChart'), {
              type: 'line',
              data: {
                labels: labels,
                datasets: txValueDatasets
              },
              options: commonOptions
            });
          }
          
          // 3. Block Reward Chart
          if (dashboardSettings.charts.show_block_rewards) {
            // Create background colors array - last bar hatched if it's the running day
            const blockRewardColors = dailyData.map((d, i) => {
              if (isLastDayRunning && i === dailyData.length - 1) {
                return createHatchPattern('rgb(255, 159, 64)');
              }
              return 'rgb(255, 159, 64)';
            });
            
            new Chart(document.getElementById('blockRewardChart'), {
              type: 'bar',
              data: {
                labels: labels,
                datasets: [{
                  label: 'Block Rewards (' + !{JSON.stringify(settings.coin.symbol)} + ')',
                  data: dailyData.map(d => d.block_reward_total),
                  backgroundColor: blockRewardColors
                }]
              },
              options: commonOptions
            });
          }
          
          // 4. Fees Chart
          if (dashboardSettings.charts.show_fees) {
            const feesDatasets = [];
            
            if (isLastDayRunning && dailyData.length > 1) {
              // Complete days dataset (solid line)
              feesDatasets.push({
                label: 'Total Fees (' + !{JSON.stringify(settings.coin.symbol)} + ')',
                data: dailyData.slice(0, -1).map(d => d.fees_total),
                borderColor: 'rgb(255, 205, 86)',
                tension: 0.1,
                pointRadius: hidePoints ? 0 : 3,
                pointHoverRadius: hidePoints ? 0 : 5
              });
              
              // Running day segment (dotted line)
              feesDatasets.push({
                label: 'Total Fees - Running Day (' + !{JSON.stringify(settings.coin.symbol)} + ')',
                data: [
                  ...Array(dailyData.length - 2).fill(null),
                  dailyData[dailyData.length - 2].fees_total,
                  dailyData[dailyData.length - 1].fees_total
                ],
                borderColor: 'rgb(255, 205, 86)',
                tension: 0.1,
                borderDash: [5, 5],
                pointRadius: hidePoints ? 0 : 3,
                pointHoverRadius: hidePoints ? 0 : 5
              });
            } else {
              // No running day or only one data point
              feesDatasets.push({
                label: 'Total Fees (' + !{JSON.stringify(settings.coin.symbol)} + ')',
                data: dailyData.map(d => d.fees_total),
                borderColor: 'rgb(255, 205, 86)',
                tension: 0.1,
                pointRadius: hidePoints ? 0 : 3,
                pointHoverRadius: hidePoints ? 0 : 5
              });
            }
            
            new Chart(document.getElementById('feesChart'), {
              type: 'line',
              data: {
                labels: labels,
                datasets: feesDatasets
              },
              options: commonOptions
            });
          }
          
          // 5. Blocks Chart
          if (dashboardSettings.charts.show_blocks) {
            // Create background colors array - last bar hatched if it's the running day
            const blocksColors = dailyData.map((d, i) => {
              if (isLastDayRunning && i === dailyData.length - 1) {
                return createHatchPattern('rgb(54, 162, 235)');
              }
              return 'rgb(54, 162, 235)';
            });
            
            new Chart(document.getElementById('blocksChart'), {
              type: 'bar',
              data: {
                labels: labels,
                datasets: [{
                  label: 'Blocks per Day',
                  data: dailyData.map(d => d.blocks),
                  backgroundColor: blocksColors
                }]
              },
              options: commonOptions
            });
          }
          
          // 6. Block Time Chart
          if (dashboardSettings.charts.show_block_time) {
            const blockTimeDatasets = [];
            
            if (isLastDayRunning && dailyData.length > 1) {
              // Complete days dataset (solid line)
              blockTimeDatasets.push({
                label: 'Avg Block Time (seconds)',
                data: dailyData.slice(0, -1).map(d => d.avg_block_time),
                borderColor: 'rgb(255, 99, 132)',
                tension: 0.1,
                pointRadius: hidePoints ? 0 : 3,
                pointHoverRadius: hidePoints ? 0 : 5
              });
              
              // Running day segment (dotted line)
              blockTimeDatasets.push({
                label: 'Avg Block Time - Running Day (seconds)',
                data: [
                  ...Array(dailyData.length - 2).fill(null),
                  dailyData[dailyData.length - 2].avg_block_time,
                  dailyData[dailyData.length - 1].avg_block_time
                ],
                borderColor: 'rgb(255, 99, 132)',
                tension: 0.1,
                borderDash: [5, 5],
                pointRadius: hidePoints ? 0 : 3,
                pointHoverRadius: hidePoints ? 0 : 5
              });
            } else {
              // No running day or only one data point
              blockTimeDatasets.push({
                label: 'Avg Block Time (seconds)',
                data: dailyData.map(d => d.avg_block_time),
                borderColor: 'rgb(255, 99, 132)',
                tension: 0.1,
                pointRadius: hidePoints ? 0 : 3,
                pointHoverRadius: hidePoints ? 0 : 5
              });
            }
            
            new Chart(document.getElementById('blockTimeChart'), {
              type: 'line',
              data: {
                labels: labels,
                datasets: blockTimeDatasets
              },
              options: commonOptions
            });
          }
        });
    else if !hasTimeSeries
      .row.g-4.mt-1
        // Block Interval
        .col-xl-3.col-lg-4.col-md-6
          .card.h-100
            .card-body
              h5.card-title
                i.fas.fa-clock.me-2
                | Block Interval
              hr
              p.h4.mb-0= data.blockInterval + ' seconds'
              small.text-muted Average of last 10 blocks

        // Recent Block Tx Count
        .col-xl-3.col-lg-4.col-md-6
          .card.h-100
            .card-body
              h5.card-title
                i.fas.fa-list.me-2
                | Recent Block Txs
              hr
              p.h4.mb-0= data.recentBlockTxs
              small.text-muted Transactions in latest block
